---
# tasks file for Apache Maven
- name: check if apache-maven exists or not
  stat:
    path: /opt/apache-maven-3.8.7
  register: apache_maven_installed

- name: "maven is installed and starting tomcat services" 
  debug:
     msg: "apache-maven-3.8.7 is exists"
  when: apache_maven_installed.stat.exists == True
  


- name: "maven is not installed"
  debug:
    msg: "apache-maven-3.8.7 doesn't exists"
  when: apache_maven_installed.stat.exists == False

- name: downloading maven packages
  get_url:
    url: "{{ maven_url  }}"
    dest: /opt
    mode: 0755
  when: apache_maven_installed.stat.exists == False

- name: extract packages
  unarchive:
    src: /opt/{{ maven_package }}.tar.gz
    dest: /opt
    remote_src: yes
  when: apache_maven_installed.stat.exists == False

- name: change permissions on apache maven file
  file:
    path: /opt/{{ maven_package }}
    mode: 0755
    recurse: yes
  when: apache_maven_installed.stat.exists == False
  
- name: Adding Environment variables to Bash Profile
  shell:
     echo 'M2_HOME=/opt/apache-maven-3.8.7' >> ~/.bash_profile
     echo 'M2=/opt/apache-maven-3.8.7/bin' >> ~/.bash_profile
     echo 'export M2_HOME' >> ~/.bash_profile
     echo  'export M2' >> ~/.bash_profile
     echo 'PATH=$M2_HOME:$M2' >> ~/.bash_profile
     source ~/.bash_profile
  